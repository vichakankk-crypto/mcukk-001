<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡∏£‡∏∞‡∏ö‡∏ö‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô‡∏Å‡∏≤‡∏£‡∏õ‡∏è‡∏¥‡∏ö‡∏±‡∏ï‡∏¥‡∏á‡∏≤‡∏ô‡∏û‡∏£‡∏∞‡∏™‡∏≠‡∏ô‡∏®‡∏µ‡∏•‡∏ò‡∏£‡∏£‡∏°‡πÉ‡∏ô‡πÇ‡∏£‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    
    <!-- Firebase v11+ SDK -->
    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js';
        import { getDatabase, ref, push, set, get, remove, onValue } from 'https://www.gstatic.com/firebasejs/11.0.1/firebase-database.js';
        
        // Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyBDJGWms4rjLvgR-MoJGNDWshilhP9trfI",
            authDomain: "mcukk-c2fd6.firebaseapp.com",
            databaseURL: "https://mcukk-c2fd6-default-rtdb.asia-southeast1.firebasedatabase.app",
            projectId: "mcukk-c2fd6",
            storageBucket: "mcukk-c2fd6.firebasestorage.app",
            messagingSenderId: "676401548006",
            appId: "1:676401548006:web:da9f72c2cb46ee069a0927"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const database = getDatabase(app);
        
        // Make Firebase functions available globally
        window.firebaseDB = {
            database,
            ref,
            push,
            set,
            get,
            remove,
            onValue
        };
        
        // Initialize app after Firebase is ready
        window.initializeFirebaseApp();
    </script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Sarabun:wght@300;400;500;600;700&display=swap');
        body { font-family: 'Sarabun', sans-serif; }
        .fade-in { animation: fadeIn 0.5s ease-in; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .hover-scale { transition: transform 0.2s; }
        .hover-scale:hover { transform: scale(1.02); }
    </style>
</head>
<body class="bg-gradient-to-br from-pink-50 to-rose-100 min-h-screen">
    <!-- Navigation -->
    <nav class="bg-white shadow-sm border-b border-pink-100">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex flex-col sm:flex-row justify-between items-center py-3 sm:py-0 sm:h-16">
                <div class="flex items-center space-x-2 sm:space-x-4 mb-3 sm:mb-0">
                    <div class="w-8 h-8 sm:w-10 sm:h-10 bg-gradient-to-r from-pink-600 to-rose-600 rounded-lg flex items-center justify-center">
                        <span class="text-white font-bold text-sm sm:text-lg">üìä</span>
                    </div>
                    <h1 class="text-lg sm:text-xl font-semibold text-gray-800 text-center sm:text-left">‡∏£‡∏∞‡∏ö‡∏ö‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô‡∏û‡∏£‡∏∞‡∏™‡∏≠‡∏ô‡∏®‡∏µ‡∏•‡∏ò‡∏£‡∏£‡∏°</h1>
                    <div id="firebaseStatus" class="hidden sm:flex text-xs text-gray-500 items-center">
                        <span class="w-2 h-2 bg-yellow-500 rounded-full mr-1 animate-pulse"></span>
                        ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ Firebase...
                    </div>
                </div>
                <div class="flex flex-wrap justify-center gap-2 sm:space-x-4">
                    <button onclick="showSection('evaluation')" id="evalBtn" class="px-3 py-2 sm:px-4 text-sm sm:text-base text-pink-600 bg-pink-50 rounded-lg font-medium transition-colors hover:bg-pink-100">‡πÅ‡∏ö‡∏ö‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô</button>
                    <button onclick="showSection('dashboard')" id="dashBtn" class="px-3 py-2 sm:px-4 text-sm sm:text-base text-gray-600 hover:text-pink-600 hover:bg-pink-50 rounded-lg font-medium transition-colors">Dashboard</button>
                    <button onclick="showAdminLogin()" id="adminBtn" class="px-3 py-2 sm:px-4 text-sm sm:text-base text-gray-600 hover:text-pink-600 hover:bg-pink-50 rounded-lg font-medium transition-colors">‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏•‡∏£‡∏∞‡∏ö‡∏ö</button>
                </div>
            </div>
        </div>
    </nav>

    <!-- Evaluation Form Section -->
    <div id="evaluationSection" class="max-w-4xl mx-auto p-3 sm:p-6 fade-in">
        <!-- Statistics Boxes -->
        <div class="grid grid-cols-2 lg:grid-cols-4 gap-3 sm:gap-4 mb-4 sm:mb-6">
            <div class="bg-white rounded-xl shadow-sm border border-pink-100 p-3 sm:p-4 hover-scale">
                <div class="flex flex-col sm:flex-row items-center sm:justify-between">
                    <div class="text-center sm:text-left mb-2 sm:mb-0">
                        <p class="text-xs sm:text-sm text-gray-600">‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</p>
                        <p class="text-lg sm:text-xl font-bold text-pink-600" id="evalTotalEvaluations">0</p>
                    </div>
                    <div class="w-8 h-8 sm:w-10 sm:h-10 bg-pink-100 rounded-lg flex items-center justify-center">
                        <span class="text-pink-600 text-sm sm:text-lg">üìã</span>
                    </div>
                </div>
            </div>
            <div class="bg-white rounded-xl shadow-sm border border-pink-100 p-3 sm:p-4 hover-scale">
                <div class="flex flex-col sm:flex-row items-center sm:justify-between">
                    <div class="text-center sm:text-left mb-2 sm:mb-0">
                        <p class="text-xs sm:text-sm text-gray-600">‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢</p>
                        <p class="text-lg sm:text-xl font-bold text-green-600" id="evalAverageScore">0.0</p>
                    </div>
                    <div class="w-8 h-8 sm:w-10 sm:h-10 bg-green-100 rounded-lg flex items-center justify-center">
                        <span class="text-green-600 text-sm sm:text-lg">‚≠ê</span>
                    </div>
                </div>
            </div>
            <div class="bg-white rounded-xl shadow-sm border border-pink-100 p-3 sm:p-4 hover-scale">
                <div class="flex flex-col sm:flex-row items-center sm:justify-between">
                    <div class="text-center sm:text-left mb-2 sm:mb-0">
                        <p class="text-xs sm:text-sm text-gray-600">‡∏û‡∏£‡∏∞‡∏™‡∏≠‡∏ô‡∏®‡∏µ‡∏•‡∏ò‡∏£‡∏£‡∏°</p>
                        <p class="text-lg sm:text-xl font-bold text-rose-600" id="evalTotalTeachers">0</p>
                    </div>
                    <div class="w-8 h-8 sm:w-10 sm:h-10 bg-rose-100 rounded-lg flex items-center justify-center">
                        <span class="text-rose-600 text-sm sm:text-lg">üë®‚Äçüè´</span>
                    </div>
                </div>
            </div>
            <div class="bg-white rounded-xl shadow-sm border border-pink-100 p-3 sm:p-4 hover-scale">
                <div class="flex flex-col sm:flex-row items-center sm:justify-between">
                    <div class="text-center sm:text-left mb-2 sm:mb-0">
                        <p class="text-xs sm:text-sm text-gray-600">‡∏™‡∏ñ‡∏≤‡∏ô‡∏®‡∏∂‡∏Å‡∏©‡∏≤</p>
                        <p class="text-lg sm:text-xl font-bold text-purple-600" id="evalTotalSchools">0</p>
                    </div>
                    <div class="w-8 h-8 sm:w-10 sm:h-10 bg-purple-100 rounded-lg flex items-center justify-center">
                        <span class="text-purple-600 text-sm sm:text-lg">üè´</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Header -->
        <div class="bg-white rounded-xl shadow-sm border border-pink-100 p-4 sm:p-8 mb-4 sm:mb-6 hover-scale">
            <div class="text-center mb-4 sm:mb-6">
                <h2 class="text-lg sm:text-2xl font-bold text-gray-800 mb-2">‡πÅ‡∏ö‡∏ö‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô‡∏Å‡∏≤‡∏£‡∏õ‡∏è‡∏¥‡∏ö‡∏±‡∏ï‡∏¥‡∏á‡∏≤‡∏ô‡∏û‡∏£‡∏∞‡∏™‡∏≠‡∏ô‡∏®‡∏µ‡∏•‡∏ò‡∏£‡∏£‡∏°‡πÉ‡∏ô‡πÇ‡∏£‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</h2>
                <p class="text-sm sm:text-base text-gray-600">‡∏°‡∏´‡∏≤‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏•‡∏±‡∏¢‡∏°‡∏´‡∏≤‡∏à‡∏∏‡∏¨‡∏≤‡∏•‡∏á‡∏Å‡∏£‡∏ì‡∏£‡∏≤‡∏ä‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏•‡∏±‡∏¢ ‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡πÄ‡∏Ç‡∏ï‡∏Ç‡∏≠‡∏ô‡πÅ‡∏Å‡πà‡∏ô</p>
            </div>
            
            <!-- Form Fields -->
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 sm:gap-6">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô</label>
                    <input type="text" id="evaluatorName" class="w-full px-3 py-2 sm:px-4 sm:py-3 border border-gray-200 rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-transparent transition-all text-sm sm:text-base" placeholder="‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">‡∏ä‡∏∑‡πà‡∏≠‡∏û‡∏£‡∏∞‡∏™‡∏≠‡∏ô‡∏®‡∏µ‡∏•‡∏ò‡∏£‡∏£‡∏°</label>
                    <input type="text" id="teacherName" class="w-full px-3 py-2 sm:px-4 sm:py-3 border border-gray-200 rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-transparent transition-all text-sm sm:text-base" placeholder="‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡∏û‡∏£‡∏∞‡∏™‡∏≠‡∏ô‡∏®‡∏µ‡∏•‡∏ò‡∏£‡∏£‡∏°">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏ñ‡∏≤‡∏ô‡∏®‡∏∂‡∏Å‡∏©‡∏≤</label>
                    <input type="text" id="schoolName" class="w-full px-3 py-2 sm:px-4 sm:py-3 border border-gray-200 rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-transparent transition-all text-sm sm:text-base" placeholder="‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏ñ‡∏≤‡∏ô‡∏®‡∏∂‡∏Å‡∏©‡∏≤">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î</label>
                    <select id="province" class="w-full px-3 py-2 sm:px-4 sm:py-3 border border-gray-200 rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-transparent transition-all text-sm sm:text-base">
                        <option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î</option>
                        <option value="‡∏Ç‡∏≠‡∏ô‡πÅ‡∏Å‡πà‡∏ô">‡∏Ç‡∏≠‡∏ô‡πÅ‡∏Å‡πà‡∏ô</option>
                        <option value="‡∏Å‡∏≤‡∏¨‡∏™‡∏¥‡∏ô‡∏ò‡∏∏‡πå">‡∏Å‡∏≤‡∏¨‡∏™‡∏¥‡∏ô‡∏ò‡∏∏‡πå</option>
                    </select>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">‡∏†‡∏≤‡∏Ñ‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏ó‡∏µ‡πà</label>
                    <select id="semester" class="w-full px-3 py-2 sm:px-4 sm:py-3 border border-gray-200 rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-transparent transition-all text-sm sm:text-base">
                        <option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏†‡∏≤‡∏Ñ‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</option>
                        <option value="1">‡∏†‡∏≤‡∏Ñ‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏ó‡∏µ‡πà 1</option>
                        <option value="2">‡∏†‡∏≤‡∏Ñ‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏ó‡∏µ‡πà 2</option>
                    </select>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">‡∏õ‡∏µ‡∏Å‡∏≤‡∏£‡∏®‡∏∂‡∏Å‡∏©‡∏≤</label>
                    <input type="text" id="academicYear" class="w-full px-3 py-2 sm:px-4 sm:py-3 border border-gray-200 rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-transparent transition-all text-sm sm:text-base" placeholder="‡πÄ‡∏ä‡πà‡∏ô 2567">
                </div>
            </div>
        </div>

        <!-- Scoring Guide -->
        <div class="bg-white rounded-xl shadow-sm border border-pink-100 p-4 sm:p-6 mb-4 sm:mb-6 hover-scale">
            <h3 class="text-base sm:text-lg font-semibold text-gray-800 mb-3 sm:mb-4">‡∏Ñ‡∏≥‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡∏Å‡∏≤‡∏£‡πÉ‡∏´‡πâ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô</h3>
            <div class="grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-5 gap-2 sm:gap-4">
                <div class="text-center p-2 sm:p-3 bg-green-50 rounded-lg border border-green-200">
                    <div class="text-xl sm:text-2xl font-bold text-green-600 mb-1">5</div>
                    <div class="text-xs sm:text-sm font-medium text-green-800">‡∏î‡∏µ‡πÄ‡∏¢‡∏µ‡πà‡∏¢‡∏°</div>
                    <div class="text-xs text-green-600 mt-1 hidden sm:block">‡πÄ‡∏Å‡∏¥‡∏ô‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏≤‡∏î‡∏´‡∏ß‡∏±‡∏á</div>
                </div>
                <div class="text-center p-2 sm:p-3 bg-blue-50 rounded-lg border border-blue-200">
                    <div class="text-xl sm:text-2xl font-bold text-blue-600 mb-1">4</div>
                    <div class="text-xs sm:text-sm font-medium text-blue-800">‡∏î‡∏µ</div>
                    <div class="text-xs text-blue-600 mt-1 hidden sm:block">‡∏ï‡∏≤‡∏°‡∏ó‡∏µ‡πà‡∏Ñ‡∏≤‡∏î‡∏´‡∏ß‡∏±‡∏á</div>
                </div>
                <div class="text-center p-2 sm:p-3 bg-yellow-50 rounded-lg border border-yellow-200">
                    <div class="text-xl sm:text-2xl font-bold text-yellow-600 mb-1">3</div>
                    <div class="text-xs sm:text-sm font-medium text-yellow-800">‡∏û‡∏≠‡πÉ‡∏ä‡πâ</div>
                    <div class="text-xs text-yellow-600 mt-1 hidden sm:block">‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏õ‡∏≤‡∏ô‡∏Å‡∏•‡∏≤‡∏á</div>
                </div>
                <div class="text-center p-2 sm:p-3 bg-orange-50 rounded-lg border border-orange-200">
                    <div class="text-xl sm:text-2xl font-bold text-orange-600 mb-1">2</div>
                    <div class="text-xs sm:text-sm font-medium text-orange-800">‡∏Ñ‡∏ß‡∏£‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á</div>
                    <div class="text-xs text-orange-600 mt-1 hidden sm:block">‡∏¢‡∏±‡∏á‡∏Ñ‡∏ß‡∏£‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á</div>
                </div>
                <div class="text-center p-2 sm:p-3 bg-red-50 rounded-lg border border-red-200">
                    <div class="text-xl sm:text-2xl font-bold text-red-600 mb-1">1</div>
                    <div class="text-xs sm:text-sm font-medium text-red-800">‡∏ï‡πâ‡∏≠‡∏á‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á</div>
                    <div class="text-xs text-red-600 mt-1 hidden sm:block">‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á‡πÄ‡∏£‡πà‡∏á‡∏î‡πà‡∏ß‡∏ô</div>
                </div>
            </div>
        </div>

        <!-- Evaluation Table -->
        <div class="bg-white rounded-xl shadow-sm border border-pink-100 p-4 sm:p-6 mb-4 sm:mb-6 hover-scale">
            <h3 class="text-base sm:text-lg font-semibold text-gray-800 mb-4 sm:mb-6">‡∏†‡∏≤‡∏£‡∏Å‡∏¥‡∏à‡∏´‡∏•‡∏±‡∏Å‡∏Å‡∏≤‡∏£‡∏õ‡∏è‡∏¥‡∏ö‡∏±‡∏ï‡∏¥‡∏á‡∏≤‡∏ô</h3>
            <div id="evaluationTable" class="space-y-4 sm:space-y-6"></div>
        </div>

        <!-- Suggestions Section -->
        <div class="bg-white rounded-xl shadow-sm border border-pink-100 p-4 sm:p-6 mb-4 sm:mb-6 hover-scale">
            <h3 class="text-base sm:text-lg font-semibold text-gray-800 mb-3 sm:mb-4">‡∏Ç‡πâ‡∏≠‡πÄ‡∏™‡∏ô‡∏≠‡πÅ‡∏ô‡∏∞‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°</h3>
            <div class="space-y-3 sm:space-y-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">‡∏à‡∏∏‡∏î‡πÄ‡∏î‡πà‡∏ô/‡∏™‡∏¥‡πà‡∏á‡∏ó‡∏µ‡πà‡∏õ‡∏£‡∏∞‡∏ó‡∏±‡∏ö‡πÉ‡∏à</label>
                    <textarea id="strengths" rows="3" class="w-full px-3 py-2 sm:px-4 sm:py-3 border border-gray-200 rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-transparent transition-all resize-none text-sm sm:text-base" placeholder="‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏∞‡∏ö‡∏∏‡∏à‡∏∏‡∏î‡πÄ‡∏î‡πà‡∏ô‡∏´‡∏£‡∏∑‡∏≠‡∏™‡∏¥‡πà‡∏á‡∏ó‡∏µ‡πà‡∏õ‡∏£‡∏∞‡∏ó‡∏±‡∏ö‡πÉ‡∏à‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏õ‡∏è‡∏¥‡∏ö‡∏±‡∏ï‡∏¥‡∏á‡∏≤‡∏ô‡∏Ç‡∏≠‡∏á‡∏û‡∏£‡∏∞‡∏™‡∏≠‡∏ô‡∏®‡∏µ‡∏•‡∏ò‡∏£‡∏£‡∏°"></textarea>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">‡∏Ç‡πâ‡∏≠‡πÄ‡∏™‡∏ô‡∏≠‡πÅ‡∏ô‡∏∞‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Å‡∏≤‡∏£‡∏û‡∏±‡∏í‡∏ô‡∏≤</label>
                    <textarea id="improvements" rows="3" class="w-full px-3 py-2 sm:px-4 sm:py-3 border border-gray-200 rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-transparent transition-all resize-none text-sm sm:text-base" placeholder="‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏´‡πâ‡∏Ç‡πâ‡∏≠‡πÄ‡∏™‡∏ô‡∏≠‡πÅ‡∏ô‡∏∞‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Å‡∏≤‡∏£‡∏û‡∏±‡∏í‡∏ô‡∏≤‡πÅ‡∏•‡∏∞‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á‡∏Å‡∏≤‡∏£‡∏õ‡∏è‡∏¥‡∏ö‡∏±‡∏ï‡∏¥‡∏á‡∏≤‡∏ô"></textarea>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏™‡∏ô‡∏±‡∏ö‡∏™‡∏ô‡∏∏‡∏ô‡∏à‡∏≤‡∏Å‡∏°‡∏´‡∏≤‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏•‡∏±‡∏¢</label>
                    <textarea id="support" rows="3" class="w-full px-3 py-2 sm:px-4 sm:py-3 border border-gray-200 rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-transparent transition-all resize-none text-sm sm:text-base" placeholder="‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏∞‡∏ö‡∏∏‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏™‡∏ô‡∏±‡∏ö‡∏™‡∏ô‡∏∏‡∏ô‡∏´‡∏£‡∏∑‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ä‡πà‡∏ß‡∏¢‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏à‡∏≤‡∏Å‡∏°‡∏´‡∏≤‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏•‡∏±‡∏¢"></textarea>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">‡∏Ç‡πâ‡∏≠‡πÄ‡∏™‡∏ô‡∏≠‡πÅ‡∏ô‡∏∞‡∏≠‡∏∑‡πà‡∏ô‡πÜ</label>
                    <textarea id="otherSuggestions" rows="3" class="w-full px-3 py-2 sm:px-4 sm:py-3 border border-gray-200 rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-transparent transition-all resize-none text-sm sm:text-base" placeholder="‡∏Ç‡πâ‡∏≠‡πÄ‡∏™‡∏ô‡∏≠‡πÅ‡∏ô‡∏∞‡∏´‡∏£‡∏∑‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏¥‡∏î‡πÄ‡∏´‡πá‡∏ô‡∏≠‡∏∑‡πà‡∏ô‡πÜ ‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á"></textarea>
                </div>
            </div>
        </div>

        <!-- Submit Button -->
        <div class="text-center">
            <button onclick="submitEvaluation()" class="bg-gradient-to-r from-pink-600 to-rose-600 text-white px-6 py-3 sm:px-8 rounded-lg font-medium hover:from-pink-700 hover:to-rose-700 transition-all transform hover:scale-105 shadow-lg text-sm sm:text-base w-full sm:w-auto">
                ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô
            </button>
        </div>
    </div>

    <!-- Admin Section -->
    <div id="adminSection" class="max-w-6xl mx-auto p-3 sm:p-6 hidden fade-in">
        <div class="bg-white rounded-xl shadow-sm border border-pink-100 p-4 sm:p-6 mb-4 sm:mb-6">
            <h2 class="text-xl sm:text-2xl font-bold text-gray-800 mb-4 sm:mb-6">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏£‡∏∞‡∏ö‡∏ö</h2>
            
            <!-- Admin Stats -->
            <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4 sm:gap-6 mb-4 sm:mb-6">
                <div class="bg-pink-50 rounded-lg p-3 sm:p-4 border border-pink-200">
                    <h3 class="text-base sm:text-lg font-semibold text-pink-800 mb-2">‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</h3>
                    <p class="text-xl sm:text-2xl font-bold text-pink-600" id="adminTotalEvaluations">0</p>
                </div>
                <div class="bg-rose-50 rounded-lg p-3 sm:p-4 border border-rose-200">
                    <h3 class="text-base sm:text-lg font-semibold text-rose-800 mb-2">‡∏û‡∏£‡∏∞‡∏™‡∏≠‡∏ô‡∏®‡∏µ‡∏•‡∏ò‡∏£‡∏£‡∏°</h3>
                    <p class="text-xl sm:text-2xl font-bold text-rose-600" id="adminTotalTeachers">0</p>
                </div>
                <div class="bg-purple-50 rounded-lg p-3 sm:p-4 border border-purple-200">
                    <h3 class="text-base sm:text-lg font-semibold text-purple-800 mb-2">‡∏™‡∏ñ‡∏≤‡∏ô‡∏®‡∏∂‡∏Å‡∏©‡∏≤</h3>
                    <p class="text-xl sm:text-2xl font-bold text-purple-600" id="adminTotalSchools">0</p>
                </div>
            </div>

            <!-- Data Management -->
            <div class="bg-gray-50 rounded-lg p-3 sm:p-6">
                <h3 class="text-base sm:text-lg font-semibold text-gray-800 mb-3 sm:mb-4">‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô</h3>
                <div class="mb-4 flex flex-col sm:flex-row justify-between items-start sm:items-center gap-3">
                    <div class="flex flex-col sm:flex-row gap-2">
                        <button onclick="refreshAdminData()" class="bg-pink-600 text-white px-3 py-2 sm:px-4 rounded-lg hover:bg-pink-700 transition-colors text-sm">
                            üîÑ ‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
                        </button>
                        <button onclick="clearAllData()" class="bg-red-600 text-white px-3 py-2 sm:px-4 rounded-lg hover:bg-red-700 transition-colors text-sm">
                            üóëÔ∏è ‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
                        </button>
                    </div>
                    <div class="text-sm text-gray-600">
                        ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î: <span id="dataCount">0</span> ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£
                    </div>
                </div>
                
                <div id="adminDataTable" class="overflow-x-auto">
                    <table class="w-full text-xs sm:text-sm">
                        <thead class="bg-gray-100">
                            <tr>
                                <th class="px-2 sm:px-4 py-2 text-left">‡∏•‡∏≥‡∏î‡∏±‡∏ö</th>
                                <th class="px-2 sm:px-4 py-2 text-left">‡∏ú‡∏π‡πâ‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô</th>
                                <th class="px-2 sm:px-4 py-2 text-left">‡∏û‡∏£‡∏∞‡∏™‡∏≠‡∏ô‡∏®‡∏µ‡∏•‡∏ò‡∏£‡∏£‡∏°</th>
                                <th class="px-2 sm:px-4 py-2 text-left hidden sm:table-cell">‡∏™‡∏ñ‡∏≤‡∏ô‡∏®‡∏∂‡∏Å‡∏©‡∏≤</th>
                                <th class="px-2 sm:px-4 py-2 text-left hidden md:table-cell">‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î</th>
                                <th class="px-2 sm:px-4 py-2 text-left hidden lg:table-cell">‡∏†‡∏≤‡∏Ñ‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</th>
                                <th class="px-2 sm:px-4 py-2 text-left hidden lg:table-cell">‡∏õ‡∏µ‡∏Å‡∏≤‡∏£‡∏®‡∏∂‡∏Å‡∏©‡∏≤</th>
                                <th class="px-2 sm:px-4 py-2 text-left">‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢</th>
                                <th class="px-2 sm:px-4 py-2 text-left hidden sm:table-cell">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô</th>
                                <th class="px-2 sm:px-4 py-2 text-left">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£</th>
                            </tr>
                        </thead>
                        <tbody id="adminTableBody">
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Detailed Suggestions Section -->
        <div class="bg-white rounded-xl shadow-sm border border-pink-100 p-6">
            <h3 class="text-lg font-semibold text-gray-800 mb-4">‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏Ç‡πâ‡∏≠‡πÄ‡∏™‡∏ô‡∏≠‡πÅ‡∏ô‡∏∞‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</h3>
            <div class="mb-4">
                <button onclick="toggleSuggestionsView()" id="toggleSuggestionsBtn" class="bg-pink-600 text-white px-4 py-2 rounded-lg hover:bg-pink-700 transition-colors">
                    üìù ‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡πÄ‡∏™‡∏ô‡∏≠‡πÅ‡∏ô‡∏∞
                </button>
            </div>
            
            <div id="suggestionsDetailView" class="hidden">
                <div class="space-y-6" id="suggestionsContainer">
                    <p class="text-gray-500 italic text-center py-8">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡πÄ‡∏™‡∏ô‡∏≠‡πÅ‡∏ô‡∏∞</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Dashboard Section -->
    <div id="dashboardSection" class="max-w-6xl mx-auto p-3 sm:p-6 hidden fade-in">
        <div class="mb-4 sm:mb-6">
            <h2 class="text-xl sm:text-2xl font-bold text-gray-800 mb-3 sm:mb-4">Dashboard ‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏°‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô</h2>
            
            <!-- Filters -->
            <div class="bg-white rounded-xl shadow-sm border border-pink-100 p-4 sm:p-6 mb-4 sm:mb-6">
                <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-3 sm:gap-4">
                    <select id="filterProvince" class="px-3 py-2 sm:px-4 border border-gray-200 rounded-lg focus:ring-2 focus:ring-pink-500 text-sm sm:text-base">
                        <option value="">‡∏ó‡∏∏‡∏Å‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î</option>
                        <option value="‡∏Ç‡∏≠‡∏ô‡πÅ‡∏Å‡πà‡∏ô">‡∏Ç‡∏≠‡∏ô‡πÅ‡∏Å‡πà‡∏ô</option>
                        <option value="‡∏Å‡∏≤‡∏¨‡∏™‡∏¥‡∏ô‡∏ò‡∏∏‡πå">‡∏Å‡∏≤‡∏¨‡∏™‡∏¥‡∏ô‡∏ò‡∏∏‡πå</option>
                    </select>
                    <select id="filterSemester" class="px-3 py-2 sm:px-4 border border-gray-200 rounded-lg focus:ring-2 focus:ring-pink-500 text-sm sm:text-base">
                        <option value="">‡∏ó‡∏∏‡∏Å‡∏†‡∏≤‡∏Ñ‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</option>
                        <option value="1">‡∏†‡∏≤‡∏Ñ‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏ó‡∏µ‡πà 1</option>
                        <option value="2">‡∏†‡∏≤‡∏Ñ‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏ó‡∏µ‡πà 2</option>
                    </select>
                    <input type="text" id="filterYear" placeholder="‡∏õ‡∏µ‡∏Å‡∏≤‡∏£‡∏®‡∏∂‡∏Å‡∏©‡∏≤" class="px-3 py-2 sm:px-4 border border-gray-200 rounded-lg focus:ring-2 focus:ring-pink-500 text-sm sm:text-base">
                    <button onclick="applyFilters()" class="bg-pink-600 text-white px-3 py-2 sm:px-4 rounded-lg hover:bg-pink-700 transition-colors text-sm sm:text-base">‡∏Å‡∏£‡∏≠‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</button>
                </div>
            </div>
        </div>

        <!-- Summary Cards -->
        <div class="grid grid-cols-2 lg:grid-cols-4 gap-3 sm:gap-6 mb-4 sm:mb-6">
            <div class="bg-white rounded-xl shadow-sm border border-pink-100 p-3 sm:p-6 hover-scale">
                <div class="flex flex-col sm:flex-row items-center sm:justify-between">
                    <div class="text-center sm:text-left mb-2 sm:mb-0">
                        <p class="text-xs sm:text-sm text-gray-600">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</p>
                        <p class="text-lg sm:text-2xl font-bold text-gray-800" id="totalEvaluations">0</p>
                    </div>
                    <div class="w-8 h-8 sm:w-12 sm:h-12 bg-pink-100 rounded-lg flex items-center justify-center">
                        <span class="text-pink-600 text-sm sm:text-xl">üìã</span>
                    </div>
                </div>
            </div>
            <div class="bg-white rounded-xl shadow-sm border border-pink-100 p-3 sm:p-6 hover-scale">
                <div class="flex flex-col sm:flex-row items-center sm:justify-between">
                    <div class="text-center sm:text-left mb-2 sm:mb-0">
                        <p class="text-xs sm:text-sm text-gray-600">‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢‡∏£‡∏ß‡∏°</p>
                        <p class="text-lg sm:text-2xl font-bold text-green-600" id="averageScore">0.0</p>
                    </div>
                    <div class="w-8 h-8 sm:w-12 sm:h-12 bg-green-100 rounded-lg flex items-center justify-center">
                        <span class="text-green-600 text-sm sm:text-xl">‚≠ê</span>
                    </div>
                </div>
            </div>
            <div class="bg-white rounded-xl shadow-sm border border-pink-100 p-3 sm:p-6 hover-scale">
                <div class="flex flex-col sm:flex-row items-center sm:justify-between">
                    <div class="text-center sm:text-left mb-2 sm:mb-0">
                        <p class="text-xs sm:text-sm text-gray-600">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏û‡∏£‡∏∞‡∏™‡∏≠‡∏ô‡∏®‡∏µ‡∏•‡∏ò‡∏£‡∏£‡∏°</p>
                        <p class="text-lg sm:text-2xl font-bold text-rose-600" id="totalTeachers">0</p>
                    </div>
                    <div class="w-8 h-8 sm:w-12 sm:h-12 bg-rose-100 rounded-lg flex items-center justify-center">
                        <span class="text-rose-600 text-sm sm:text-xl">üë®‚Äçüè´</span>
                    </div>
                </div>
            </div>
            <div class="bg-white rounded-xl shadow-sm border border-pink-100 p-3 sm:p-6 hover-scale">
                <div class="flex flex-col sm:flex-row items-center sm:justify-between">
                    <div class="text-center sm:text-left mb-2 sm:mb-0">
                        <p class="text-xs sm:text-sm text-gray-600">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏™‡∏ñ‡∏≤‡∏ô‡∏®‡∏∂‡∏Å‡∏©‡∏≤</p>
                        <p class="text-lg sm:text-2xl font-bold text-purple-600" id="totalSchools">0</p>
                    </div>
                    <div class="w-8 h-8 sm:w-12 sm:h-12 bg-purple-100 rounded-lg flex items-center justify-center">
                        <span class="text-purple-600 text-sm sm:text-xl">üè´</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Charts -->
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-4 sm:gap-6 mb-4 sm:mb-6">
            <div class="bg-white rounded-xl shadow-sm border border-pink-100 p-4 sm:p-6 hover-scale">
                <h3 class="text-base sm:text-lg font-semibold text-gray-800 mb-3 sm:mb-4">‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢‡∏£‡∏≤‡∏¢‡∏†‡∏≤‡∏£‡∏Å‡∏¥‡∏à</h3>
                <div class="relative h-64 sm:h-80">
                    <canvas id="missionChart" class="w-full h-full"></canvas>
                </div>
            </div>
            <div class="bg-white rounded-xl shadow-sm border border-pink-100 p-4 sm:p-6 hover-scale">
                <h3 class="text-base sm:text-lg font-semibold text-gray-800 mb-3 sm:mb-4">‡∏Å‡∏≤‡∏£‡∏Å‡∏£‡∏∞‡∏à‡∏≤‡∏¢‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô</h3>
                <div class="relative h-64 sm:h-80">
                    <canvas id="distributionChart" class="w-full h-full"></canvas>
                </div>
            </div>
        </div>

        <!-- Suggestions Summary -->
        <div class="bg-white rounded-xl shadow-sm border border-pink-100 p-6 mb-6">
            <h3 class="text-lg font-semibold text-gray-800 mb-4">‡∏™‡∏£‡∏∏‡∏õ‡∏Ç‡πâ‡∏≠‡πÄ‡∏™‡∏ô‡∏≠‡πÅ‡∏ô‡∏∞</h3>
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                <div class="bg-green-50 rounded-lg p-4 border border-green-200">
                    <h4 class="font-semibold text-green-800 mb-3 flex items-center">
                        <span class="mr-2">‚ú®</span>
                        ‡∏à‡∏∏‡∏î‡πÄ‡∏î‡πà‡∏ô‡∏ó‡∏µ‡πà‡∏û‡∏ö‡∏ö‡πà‡∏≠‡∏¢
                    </h4>
                    <div id="commonStrengths" class="text-sm text-green-700 space-y-1">
                        <p class="text-gray-500 italic">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</p>
                    </div>
                </div>
                <div class="bg-blue-50 rounded-lg p-4 border border-blue-200">
                    <h4 class="font-semibold text-blue-800 mb-3 flex items-center">
                        <span class="mr-2">üí°</span>
                        ‡∏Ç‡πâ‡∏≠‡πÄ‡∏™‡∏ô‡∏≠‡πÅ‡∏ô‡∏∞‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏û‡∏±‡∏í‡∏ô‡∏≤
                    </h4>
                    <div id="commonImprovements" class="text-sm text-blue-700 space-y-1">
                        <p class="text-gray-500 italic">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</p>
                    </div>
                </div>
                <div class="bg-purple-50 rounded-lg p-4 border border-purple-200">
                    <h4 class="font-semibold text-purple-800 mb-3 flex items-center">
                        <span class="mr-2">ü§ù</span>
                        ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏™‡∏ô‡∏±‡∏ö‡∏™‡∏ô‡∏∏‡∏ô
                    </h4>
                    <div id="commonSupport" class="text-sm text-purple-700 space-y-1">
                        <p class="text-gray-500 italic">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</p>
                    </div>
                </div>
                <div class="bg-orange-50 rounded-lg p-4 border border-orange-200">
                    <h4 class="font-semibold text-orange-800 mb-3 flex items-center">
                        <span class="mr-2">üí¨</span>
                        ‡∏Ç‡πâ‡∏≠‡πÄ‡∏™‡∏ô‡∏≠‡πÅ‡∏ô‡∏∞‡∏≠‡∏∑‡πà‡∏ô‡πÜ
                    </h4>
                    <div id="otherComments" class="text-sm text-orange-700 space-y-1">
                        <p class="text-gray-500 italic">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Export Buttons -->
        <div class="bg-white rounded-xl shadow-sm border border-pink-100 p-6">
            <h3 class="text-lg font-semibold text-gray-800 mb-4">‡∏™‡πà‡∏á‡∏≠‡∏≠‡∏Å‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô</h3>
            <div class="flex space-x-4">
                <button onclick="exportToExcel()" class="bg-green-600 text-white px-6 py-2 rounded-lg hover:bg-green-700 transition-colors flex items-center space-x-2">
                    <span>üìä</span>
                    <span>Export Excel</span>
                </button>
                <button onclick="exportToPDF()" class="bg-red-600 text-white px-6 py-2 rounded-lg hover:bg-red-700 transition-colors flex items-center space-x-2">
                    <span>üìÑ</span>
                    <span>Export PDF</span>
                </button>
            </div>
        </div>
    </div>

    <script>
        // Mission data structure
        const missions = [
            {
                name: "‡∏£‡πà‡∏ß‡∏°‡∏ß‡∏≤‡∏á‡πÅ‡∏ú‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡∏≠‡∏ô‡∏™‡∏≤‡∏£‡∏∞‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏£‡∏π‡πâ‡∏û‡∏£‡∏∞‡∏û‡∏∏‡∏ó‡∏ò‡∏®‡∏≤‡∏™‡∏ô‡∏≤",
                items: [
                    "‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡πà‡∏ß‡∏°‡∏õ‡∏£‡∏∞‡∏ä‡∏∏‡∏°‡∏ß‡∏≤‡∏á‡πÅ‡∏ú‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡∏≠‡∏ô‡∏Å‡∏±‡∏ö‡∏Ñ‡∏£‡∏π‡∏™‡∏±‡∏á‡∏Ñ‡∏°‡∏®‡∏∂‡∏Å‡∏©‡∏≤",
                    "‡∏ô‡∏≥‡∏´‡∏•‡∏±‡∏Å‡∏™‡∏π‡∏ï‡∏£‡πÅ‡∏Å‡∏ô‡∏Å‡∏•‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡∏®‡∏∂‡∏Å‡∏©‡∏≤‡∏°‡∏≤‡∏à‡∏±‡∏î‡∏ó‡∏≥‡πÅ‡∏ú‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡∏≠‡∏ô",
                    "‡∏à‡∏±‡∏î‡∏ó‡∏≥‡πÅ‡∏ú‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡∏≠‡∏ô‡∏ï‡∏≤‡∏°‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏ä‡∏±‡πâ‡∏ô‡πÅ‡∏•‡∏∞‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏ô‡πÉ‡∏à‡∏Ç‡∏≠‡∏á‡∏ú‡∏π‡πâ‡πÄ‡∏£‡∏µ‡∏¢‡∏ô"
                ]
            },
            {
                name: "‡∏£‡πà‡∏ß‡∏°‡∏ß‡∏≤‡∏á‡πÅ‡∏ú‡∏ô‡πÅ‡∏•‡∏∞‡∏à‡∏±‡∏î‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏û‡∏±‡∏í‡∏ô‡∏≤‡∏ú‡∏π‡πâ‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏î‡πâ‡∏≤‡∏ô‡∏Ñ‡∏∏‡∏ì‡∏ò‡∏£‡∏£‡∏° ‡∏®‡∏µ‡∏•‡∏ò‡∏£‡∏£‡∏°",
                items: [
                    "‡∏à‡∏±‡∏î‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏≠‡∏ö‡∏£‡∏°/‡∏ö‡∏£‡∏£‡∏¢‡∏≤‡∏¢‡∏î‡πâ‡∏≤‡∏ô‡∏Ñ‡∏∏‡∏ì‡∏ò‡∏£‡∏£‡∏° ‡∏à‡∏£‡∏¥‡∏¢‡∏ò‡∏£‡∏£‡∏°",
                    "‡∏™‡∏≠‡∏î‡πÅ‡∏ó‡∏£‡∏Å‡∏°‡∏≤‡∏£‡∏¢‡∏≤‡∏ó‡∏ä‡∏≤‡∏ß‡∏û‡∏∏‡∏ó‡∏ò‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°",
                    "‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏£‡πà‡∏ß‡∏°‡∏Å‡∏±‡∏ö‡∏Ñ‡∏£‡∏π‡∏ù‡πà‡∏≤‡∏¢‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ô‡∏≥‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡πÑ‡∏õ‡∏™‡∏π‡πà‡∏Å‡∏≤‡∏£‡∏õ‡∏è‡∏¥‡∏ö‡∏±‡∏ï‡∏¥"
                ]
            },
            {
                name: "‡∏à‡∏±‡∏î‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏ï‡∏¥‡∏ß‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡πÉ‡∏´‡πâ‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏™‡∏≠‡∏ö‡∏ò‡∏£‡∏£‡∏°‡∏®‡∏∂‡∏Å‡∏©‡∏≤",
                items: [
                    "‡∏à‡∏±‡∏î‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏ï‡∏¥‡∏ß‡πÉ‡∏´‡πâ‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏°‡∏Å‡∏±‡∏ö‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô",
                    "‡πÉ‡∏ä‡πâ‡∏™‡∏∑‡πà‡∏≠‡∏Å‡∏≤‡∏£‡∏ï‡∏¥‡∏ß ‡πÄ‡∏ä‡πà‡∏ô ‡πÅ‡∏ö‡∏ö‡∏ù‡∏∂‡∏Å‡∏´‡∏±‡∏î ‡∏Ç‡πâ‡∏≠‡∏™‡∏≠‡∏ö‡πÄ‡∏Å‡πà‡∏≤ ‡∏´‡∏£‡∏∑‡∏≠‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏Å‡∏•‡∏∏‡πà‡∏°",
                    "‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô‡∏Ñ‡∏ß‡∏≤‡∏°‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏Å‡πà‡∏≠‡∏ô‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏≠‡∏ö"
                ]
            },
            {
                name: "‡∏£‡πà‡∏ß‡∏°‡∏û‡∏±‡∏í‡∏ô‡∏≤‡πÇ‡∏£‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏ß‡∏¥‡∏ñ‡∏µ‡∏û‡∏∏‡∏ó‡∏ò‡∏Å‡∏±‡∏ö‡∏™‡∏ñ‡∏≤‡∏ô‡∏®‡∏∂‡∏Å‡∏©‡∏≤",
                items: [
                    "‡∏™‡πà‡∏á‡πÄ‡∏™‡∏£‡∏¥‡∏°‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏´‡∏•‡∏±‡∏Å‡∏ò‡∏£‡∏£‡∏°‡πÉ‡∏ô‡∏Å‡∏¥‡∏à‡∏ß‡∏±‡∏ï‡∏£‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ß‡∏±‡∏ô‡∏Ç‡∏≠‡∏á‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô",
                    "‡∏£‡πà‡∏ß‡∏°‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡πÇ‡∏£‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏ß‡∏¥‡∏ñ‡∏µ‡∏û‡∏∏‡∏ó‡∏ò ‡πÄ‡∏ä‡πà‡∏ô ‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏ß‡∏±‡∏ô‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç‡∏ó‡∏≤‡∏á‡∏û‡∏£‡∏∞‡∏û‡∏∏‡∏ó‡∏ò‡∏®‡∏≤‡∏™‡∏ô‡∏≤",
                    "‡∏õ‡∏£‡∏∞‡∏™‡∏≤‡∏ô‡∏á‡∏≤‡∏ô‡∏Å‡∏±‡∏ö‡∏ú‡∏π‡πâ‡∏ö‡∏£‡∏¥‡∏´‡∏≤‡∏£‡πÅ‡∏•‡∏∞‡∏Ñ‡∏£‡∏π‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏û‡∏±‡∏í‡∏ô‡∏≤‡πÅ‡∏´‡∏•‡πà‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏£‡∏π‡πâ"
                ]
            },
            {
                name: "‡∏õ‡∏£‡∏∞‡∏™‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á‡∏Ñ‡∏ì‡∏∞‡∏™‡∏á‡∏Ü‡πå‡∏Å‡∏±‡∏ö‡∏™‡∏ñ‡∏≤‡∏ô‡∏®‡∏∂‡∏Å‡∏©‡∏≤",
                items: [
                    "‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠‡∏õ‡∏£‡∏∞‡∏™‡∏≤‡∏ô‡∏á‡∏≤‡∏ô‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á‡∏ß‡∏±‡∏î‡πÅ‡∏•‡∏∞‡πÇ‡∏£‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏à‡∏±‡∏î‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏ó‡∏≤‡∏á‡∏®‡∏≤‡∏™‡∏ô‡∏≤",
                    "‡πÄ‡∏ä‡∏¥‡∏ç‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏Å‡∏£‡∏û‡∏£‡∏∞‡∏™‡∏á‡∏Ü‡πå/‡∏û‡∏£‡∏∞‡∏≠‡∏≤‡∏à‡∏≤‡∏£‡∏¢‡πå‡∏°‡∏≤‡∏£‡πà‡∏ß‡∏°‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°",
                    "‡∏™‡∏£‡∏∏‡∏õ‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡πà‡∏ß‡∏°‡∏°‡∏∑‡∏≠‡πÅ‡∏•‡∏∞‡∏ô‡∏≥‡πÄ‡∏™‡∏ô‡∏≠‡∏ú‡∏π‡πâ‡∏ö‡∏£‡∏¥‡∏´‡∏≤‡∏£"
                ]
            },
            {
                name: "‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏õ‡∏è‡∏¥‡∏ö‡∏±‡∏ï‡∏¥‡∏á‡∏≤‡∏ô‡πÅ‡∏•‡∏∞‡πÄ‡∏™‡∏ô‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏¥‡∏î‡πÄ‡∏´‡πá‡∏ô",
                items: [
                    "‡∏à‡∏±‡∏î‡∏ó‡∏≥‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏õ‡∏è‡∏¥‡∏ö‡∏±‡∏ï‡∏¥‡∏á‡∏≤‡∏ô‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏ï‡∏≤‡∏°‡πÅ‡∏ö‡∏ö‡∏ü‡∏≠‡∏£‡πå‡∏°",
                    "‡πÄ‡∏™‡∏ô‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏¥‡∏î‡πÄ‡∏´‡πá‡∏ô‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡πÅ‡∏Å‡πà‡∏ú‡∏π‡πâ‡∏ö‡∏£‡∏¥‡∏´‡∏≤‡∏£‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£",
                    "‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡∏Ç‡∏≠‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡πà‡∏≠‡∏ô‡∏™‡πà‡∏á‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô"
                ]
            },
            {
                name: "‡∏î‡πâ‡∏≤‡∏ô‡∏Ñ‡∏∏‡∏ì‡∏ò‡∏£‡∏£‡∏° ‡∏à‡∏£‡∏¥‡∏¢‡∏ò‡∏£‡∏£‡∏° ‡πÅ‡∏•‡∏∞‡∏à‡∏£‡∏£‡∏¢‡∏≤‡∏ö‡∏£‡∏£‡∏ì",
                items: [
                    "‡∏õ‡∏è‡∏¥‡∏ö‡∏±‡∏ï‡∏¥‡∏ï‡∏ô‡∏ï‡∏≤‡∏°‡∏û‡∏£‡∏∞‡∏ò‡∏£‡∏£‡∏°‡∏ß‡∏¥‡∏ô‡∏±‡∏¢‡πÅ‡∏•‡∏∞‡∏à‡∏£‡∏£‡∏¢‡∏≤‡∏ö‡∏£‡∏£‡∏ì‡∏û‡∏£‡∏∞‡∏™‡∏≠‡∏ô‡∏®‡∏µ‡∏•‡∏ò‡∏£‡∏£‡∏°",
                    "‡πÅ‡∏™‡∏î‡∏á‡∏≠‡∏≠‡∏Å‡∏ñ‡∏∂‡∏á‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ã‡∏∑‡πà‡∏≠‡∏™‡∏±‡∏ï‡∏¢‡πå ‡∏™‡∏∏‡∏†‡∏≤‡∏û ‡πÅ‡∏•‡∏∞‡πÄ‡∏õ‡πá‡∏ô‡πÅ‡∏ö‡∏ö‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ó‡∏µ‡πà‡∏î‡∏µ",
                    "‡∏£‡∏±‡∏Å‡∏©‡∏≤‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏±‡∏°‡∏û‡∏±‡∏ô‡∏ò‡πå‡∏ó‡∏µ‡πà‡∏î‡∏µ‡∏Å‡∏±‡∏ö‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô ‡∏Ñ‡∏£‡∏π ‡πÅ‡∏•‡∏∞‡∏ä‡∏∏‡∏°‡∏ä‡∏ô"
                ]
            }
        ];

        let evaluationData = [];
        let isFirebaseReady = false;

        // Initialize Firebase App
        window.initializeFirebaseApp = function() {
            isFirebaseReady = true;
            console.log('Firebase initialized successfully');
            
            // Update Firebase status indicator
            const statusElement = document.getElementById('firebaseStatus');
            if (statusElement) {
                statusElement.innerHTML = `
                    <span class="w-2 h-2 bg-green-500 rounded-full mr-1"></span>
                    ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ Firebase ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à
                `;
                
                // Hide status after 3 seconds
                setTimeout(() => {
                    statusElement.style.display = 'none';
                }, 3000);
            }
            
            loadDataFromFirebase();
        };

        // Load data from Firebase
        async function loadDataFromFirebase() {
            if (!isFirebaseReady) return;
            
            try {
                const { database, ref, get } = window.firebaseDB;
                const evaluationsRef = ref(database, 'evaluations');
                const snapshot = await get(evaluationsRef);
                
                if (snapshot.exists()) {
                    const data = snapshot.val();
                    evaluationData = Object.keys(data).map(key => ({
                        firebaseKey: key,
                        ...data[key]
                    }));
                    console.log('Data loaded from Firebase:', evaluationData.length, 'records');
                } else {
                    evaluationData = [];
                    console.log('No data found in Firebase');
                }
                
                updateDashboard();
                updateAdminData();
                updateEvaluationStats();
            } catch (error) {
                console.error('Error loading data from Firebase:', error);
                Swal.fire({
                    icon: 'error',
                    title: '‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î',
                    text: '‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å Firebase ‡πÑ‡∏î‡πâ',
                    confirmButtonColor: '#ec4899'
                });
            }
        }

        // Save data to Firebase
        async function saveToFirebase(evaluation) {
            if (!isFirebaseReady) {
                console.error('Firebase not ready');
                return false;
            }
            
            try {
                const { database, ref, push } = window.firebaseDB;
                const evaluationsRef = ref(database, 'evaluations');
                const newEvaluationRef = await push(evaluationsRef, evaluation);
                console.log('Data saved to Firebase with key:', newEvaluationRef.key);
                return newEvaluationRef.key;
            } catch (error) {
                console.error('Error saving to Firebase:', error);
                throw error;
            }
        }

        // Delete from Firebase
        async function deleteFromFirebase(firebaseKey) {
            if (!isFirebaseReady) return false;
            
            try {
                const { database, ref, remove } = window.firebaseDB;
                const evaluationRef = ref(database, `evaluations/${firebaseKey}`);
                await remove(evaluationRef);
                console.log('Data deleted from Firebase:', firebaseKey);
                return true;
            } catch (error) {
                console.error('Error deleting from Firebase:', error);
                throw error;
            }
        }

        // Clear all data from Firebase
        async function clearAllFirebaseData() {
            if (!isFirebaseReady) return false;
            
            try {
                const { database, ref, remove } = window.firebaseDB;
                const evaluationsRef = ref(database, 'evaluations');
                await remove(evaluationsRef);
                console.log('All data cleared from Firebase');
                return true;
            } catch (error) {
                console.error('Error clearing Firebase data:', error);
                throw error;
            }
        }

        // Initialize evaluation table
        function initializeEvaluationTable() {
            const tableContainer = document.getElementById('evaluationTable');
            tableContainer.innerHTML = '';

            missions.forEach((mission, missionIndex) => {
                const missionDiv = document.createElement('div');
                missionDiv.className = 'border border-gray-200 rounded-lg p-4 mb-4';
                
                let missionHTML = `
                    <h4 class="text-md font-semibold text-gray-800 mb-4 bg-pink-50 p-3 rounded-lg">${missionIndex + 1}. ${mission.name}</h4>
                    <div class="space-y-3">
                `;

                mission.items.forEach((item, itemIndex) => {
                    missionHTML += `
                        <div class="flex flex-col sm:flex-row sm:items-center justify-between p-3 bg-gray-50 rounded-lg gap-3">
                            <span class="text-sm text-gray-700 flex-1">${missionIndex + 1}.${itemIndex + 1} ${item}</span>
                            <div class="flex justify-center sm:justify-end space-x-1 sm:space-x-2">
                                ${[1,2,3,4,5].map(score => `
                                    <label class="flex items-center">
                                        <input type="radio" name="score_${missionIndex}_${itemIndex}" value="${score}" class="sr-only">
                                        <div class="w-7 h-7 sm:w-8 sm:h-8 rounded-full border-2 border-gray-300 flex items-center justify-center cursor-pointer hover:border-pink-500 transition-colors score-radio" data-score="${score}">
                                            <span class="text-xs font-medium text-gray-600">${score}</span>
                                        </div>
                                    </label>
                                `).join('')}
                            </div>
                        </div>
                    `;
                });

                missionHTML += '</div>';
                missionDiv.innerHTML = missionHTML;
                tableContainer.appendChild(missionDiv);
            });

            // Add click handlers for radio buttons
            document.querySelectorAll('.score-radio').forEach(radio => {
                radio.addEventListener('click', function() {
                    const name = this.closest('label').querySelector('input').name;
                    const score = this.dataset.score;
                    
                    // Clear all selections for this question
                    document.querySelectorAll(`input[name="${name}"]`).forEach(input => {
                        input.checked = false;
                        input.closest('label').querySelector('.score-radio').classList.remove('bg-pink-500', 'text-white', 'border-pink-500');
                        input.closest('label').querySelector('.score-radio').classList.add('border-gray-300');
                    });
                    
                    // Select this option
                    const input = this.closest('label').querySelector('input');
                    input.checked = true;
                    this.classList.remove('border-gray-300');
                    this.classList.add('bg-pink-500', 'text-white', 'border-pink-500');
                });
            });
        }

        // Submit evaluation
        async function submitEvaluation() {
            const evaluatorName = document.getElementById('evaluatorName').value;
            const teacherName = document.getElementById('teacherName').value;
            const schoolName = document.getElementById('schoolName').value;
            const province = document.getElementById('province').value;
            const semester = document.getElementById('semester').value;
            const academicYear = document.getElementById('academicYear').value;
            
            // Get suggestions
            const strengths = document.getElementById('strengths').value;
            const improvements = document.getElementById('improvements').value;
            const support = document.getElementById('support').value;
            const otherSuggestions = document.getElementById('otherSuggestions').value;

            if (!evaluatorName || !teacherName || !schoolName || !province || !semester || !academicYear) {
                Swal.fire({
                    icon: 'warning',
                    title: '‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏°‡πà‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô',
                    text: '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô‡∏ó‡∏∏‡∏Å‡∏ä‡πà‡∏≠‡∏á',
                    confirmButtonColor: '#ec4899'
                });
                return;
            }

            const scores = [];
            let totalQuestions = 0;
            let answeredQuestions = 0;

            missions.forEach((mission, missionIndex) => {
                const missionScores = [];
                mission.items.forEach((item, itemIndex) => {
                    totalQuestions++;
                    const selectedScore = document.querySelector(`input[name="score_${missionIndex}_${itemIndex}"]:checked`);
                    if (selectedScore) {
                        missionScores.push(parseInt(selectedScore.value));
                        answeredQuestions++;
                    } else {
                        missionScores.push(0);
                    }
                });
                scores.push(missionScores);
            });

            if (answeredQuestions < totalQuestions) {
                Swal.fire({
                    icon: 'warning',
                    title: '‡∏Å‡∏≤‡∏£‡πÉ‡∏´‡πâ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡πÑ‡∏°‡πà‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô',
                    text: `‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏´‡πâ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö‡∏ó‡∏∏‡∏Å‡∏Ç‡πâ‡∏≠ (‡∏ï‡∏≠‡∏ö‡πÅ‡∏•‡πâ‡∏ß ${answeredQuestions}/${totalQuestions} ‡∏Ç‡πâ‡∏≠)`,
                    confirmButtonColor: '#ec4899'
                });
                return;
            }

            // Show loading
            Swal.fire({
                title: '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...',
                text: '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏≠‡∏™‡∏±‡∏Å‡∏Ñ‡∏£‡∏π‡πà',
                allowOutsideClick: false,
                didOpen: () => {
                    Swal.showLoading();
                }
            });

            // Simulate saving delay
            await new Promise(resolve => setTimeout(resolve, 1500));

            const evaluation = {
                id: Date.now(),
                evaluatorName,
                teacherName,
                schoolName,
                province,
                semester,
                academicYear,
                scores,
                suggestions: {
                    strengths,
                    improvements,
                    support,
                    otherSuggestions
                },
                date: new Date().toLocaleDateString('th-TH'),
                timestamp: new Date().toISOString()
            };

            try {
                // Save to Firebase
                const firebaseKey = await saveToFirebase(evaluation);
                evaluation.firebaseKey = firebaseKey;
                
                // Add to local array
                evaluationData.push(evaluation);
                
                // Also save to localStorage as backup
                localStorage.setItem('evaluationData', JSON.stringify(evaluationData));
            } catch (error) {
                console.error('Error saving evaluation:', error);
                Swal.fire({
                    icon: 'error',
                    title: '‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å',
                    text: '‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏î‡πâ ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á',
                    confirmButtonColor: '#ec4899'
                });
                return;
            }

            // Show success
            Swal.fire({
                icon: 'success',
                title: '‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!',
                text: '‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß',
                confirmButtonColor: '#ec4899'
            });
            
            // Reset form
            document.querySelectorAll('input, select, textarea').forEach(input => {
                if (input.type === 'radio') {
                    input.checked = false;
                    input.closest('label').querySelector('.score-radio').classList.remove('bg-pink-500', 'text-white', 'border-pink-500');
                    input.closest('label').querySelector('.score-radio').classList.add('border-gray-300');
                } else {
                    input.value = '';
                }
            });

            updateDashboard();
            updateAdminData();
            updateEvaluationStats();
        }

        // Show admin login
        async function showAdminLogin() {
            const { value: password } = await Swal.fire({
                title: '‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏•',
                input: 'password',
                inputLabel: '‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô',
                inputPlaceholder: '‡∏Å‡∏£‡∏≠‡∏Å‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô',
                inputAttributes: {
                    maxlength: 10,
                    autocapitalize: 'off',
                    autocorrect: 'off'
                },
                confirmButtonColor: '#ec4899',
                showCancelButton: true,
                cancelButtonText: '‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å'
            });

            if (password === '1234') {
                Swal.fire({
                    icon: 'success',
                    title: '‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à',
                    text: '‡∏¢‡∏¥‡∏ô‡∏î‡∏µ‡∏ï‡πâ‡∏≠‡∏ô‡∏£‡∏±‡∏ö‡∏™‡∏π‡πà‡∏´‡∏ô‡πâ‡∏≤‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏•‡∏£‡∏∞‡∏ö‡∏ö',
                    confirmButtonColor: '#ec4899'
                });
                showSection('admin');
            } else if (password) {
                Swal.fire({
                    icon: 'error',
                    title: '‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á',
                    text: '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á',
                    confirmButtonColor: '#ec4899'
                });
            }
        }

        // Show section
        function showSection(section) {
            document.getElementById('evaluationSection').classList.toggle('hidden', section !== 'evaluation');
            document.getElementById('dashboardSection').classList.toggle('hidden', section !== 'dashboard');
            document.getElementById('adminSection').classList.toggle('hidden', section !== 'admin');
            
            // Update button states
            document.getElementById('evalBtn').classList.toggle('text-pink-600', section === 'evaluation');
            document.getElementById('evalBtn').classList.toggle('bg-pink-50', section === 'evaluation');
            document.getElementById('evalBtn').classList.toggle('text-gray-600', section !== 'evaluation');
            
            document.getElementById('dashBtn').classList.toggle('text-pink-600', section === 'dashboard');
            document.getElementById('dashBtn').classList.toggle('bg-pink-50', section === 'dashboard');
            document.getElementById('dashBtn').classList.toggle('text-gray-600', section !== 'dashboard');

            document.getElementById('adminBtn').classList.toggle('text-pink-600', section === 'admin');
            document.getElementById('adminBtn').classList.toggle('bg-pink-50', section === 'admin');
            document.getElementById('adminBtn').classList.toggle('text-gray-600', section !== 'admin');

            if (section === 'dashboard') {
                updateDashboard();
            } else if (section === 'admin') {
                updateAdminData();
            }
        }

        // Update dashboard
        function updateDashboard() {
            const data = evaluationData;
            
            document.getElementById('totalEvaluations').textContent = data.length;
            document.getElementById('totalTeachers').textContent = new Set(data.map(d => d.teacherName)).size;
            document.getElementById('totalSchools').textContent = new Set(data.map(d => d.schoolName)).size;
            
            if (data.length > 0) {
                const allScores = data.flatMap(d => d.scores.flat()).filter(s => s > 0);
                const average = allScores.reduce((a, b) => a + b, 0) / allScores.length;
                document.getElementById('averageScore').textContent = average.toFixed(1);
            } else {
                document.getElementById('averageScore').textContent = '0.0';
            }

            updateCharts(data);
            updateSuggestionsSummary(data);
            updateEvaluationStats();
        }

        // Update suggestions summary
        function updateSuggestionsSummary(data) {
            const strengthsContainer = document.getElementById('commonStrengths');
            const improvementsContainer = document.getElementById('commonImprovements');
            const supportContainer = document.getElementById('commonSupport');
            const otherContainer = document.getElementById('otherComments');

            if (data.length === 0) {
                strengthsContainer.innerHTML = '<p class="text-gray-500 italic">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</p>';
                improvementsContainer.innerHTML = '<p class="text-gray-500 italic">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</p>';
                supportContainer.innerHTML = '<p class="text-gray-500 italic">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</p>';
                otherContainer.innerHTML = '<p class="text-gray-500 italic">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</p>';
                return;
            }

            // Get recent suggestions (last 5)
            const recentData = data.slice(-5);

            // Strengths
            const strengths = recentData
                .map(d => d.suggestions?.strengths)
                .filter(s => s && s.trim())
                .slice(-3);
            
            strengthsContainer.innerHTML = strengths.length > 0 
                ? strengths.map(s => `<p class="bg-white rounded p-2 border border-green-300">‚Ä¢ ${s}</p>`).join('')
                : '<p class="text-gray-500 italic">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</p>';

            // Improvements
            const improvements = recentData
                .map(d => d.suggestions?.improvements)
                .filter(s => s && s.trim())
                .slice(-3);
            
            improvementsContainer.innerHTML = improvements.length > 0 
                ? improvements.map(s => `<p class="bg-white rounded p-2 border border-blue-300">‚Ä¢ ${s}</p>`).join('')
                : '<p class="text-gray-500 italic">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</p>';

            // Support
            const support = recentData
                .map(d => d.suggestions?.support)
                .filter(s => s && s.trim())
                .slice(-3);
            
            supportContainer.innerHTML = support.length > 0 
                ? support.map(s => `<p class="bg-white rounded p-2 border border-purple-300">‚Ä¢ ${s}</p>`).join('')
                : '<p class="text-gray-500 italic">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</p>';

            // Other suggestions
            const others = recentData
                .map(d => d.suggestions?.otherSuggestions)
                .filter(s => s && s.trim())
                .slice(-3);
            
            otherContainer.innerHTML = others.length > 0 
                ? others.map(s => `<p class="bg-white rounded p-2 border border-orange-300">‚Ä¢ ${s}</p>`).join('')
                : '<p class="text-gray-500 italic">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</p>';
        }

        // Update evaluation page statistics
        function updateEvaluationStats() {
            const data = evaluationData;
            
            document.getElementById('evalTotalEvaluations').textContent = data.length;
            document.getElementById('evalTotalTeachers').textContent = new Set(data.map(d => d.teacherName)).size;
            document.getElementById('evalTotalSchools').textContent = new Set(data.map(d => d.schoolName)).size;
            
            if (data.length > 0) {
                const allScores = data.flatMap(d => d.scores.flat()).filter(s => s > 0);
                const average = allScores.reduce((a, b) => a + b, 0) / allScores.length;
                document.getElementById('evalAverageScore').textContent = average.toFixed(1);
            } else {
                document.getElementById('evalAverageScore').textContent = '0.0';
            }
        }

        // Update admin data
        function updateAdminData() {
            const data = evaluationData;
            
            // Update admin stats
            document.getElementById('adminTotalEvaluations').textContent = data.length;
            document.getElementById('adminTotalTeachers').textContent = new Set(data.map(d => d.teacherName)).size;
            document.getElementById('adminTotalSchools').textContent = new Set(data.map(d => d.schoolName)).size;
            document.getElementById('dataCount').textContent = data.length;
            
            // Update admin table
            const tableBody = document.getElementById('adminTableBody');
            tableBody.innerHTML = '';
            
            data.forEach((evaluation, index) => {
                const allScores = evaluation.scores.flat().filter(s => s > 0);
                const average = allScores.length > 0 ? (allScores.reduce((a, b) => a + b, 0) / allScores.length).toFixed(1) : '0.0';
                
                const row = document.createElement('tr');
                row.className = 'border-b hover:bg-gray-50';
                row.innerHTML = `
                    <td class="px-2 sm:px-4 py-2">${index + 1}</td>
                    <td class="px-2 sm:px-4 py-2">${evaluation.evaluatorName || '-'}</td>
                    <td class="px-2 sm:px-4 py-2">${evaluation.teacherName}</td>
                    <td class="px-2 sm:px-4 py-2 hidden sm:table-cell">${evaluation.schoolName}</td>
                    <td class="px-2 sm:px-4 py-2 hidden md:table-cell">${evaluation.province}</td>
                    <td class="px-2 sm:px-4 py-2 hidden lg:table-cell">‡∏†‡∏≤‡∏Ñ‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏ó‡∏µ‡πà ${evaluation.semester}</td>
                    <td class="px-2 sm:px-4 py-2 hidden lg:table-cell">${evaluation.academicYear}</td>
                    <td class="px-2 sm:px-4 py-2">${average}</td>
                    <td class="px-2 sm:px-4 py-2 hidden sm:table-cell">${evaluation.date}</td>
                    <td class="px-2 sm:px-4 py-2">
                        <button onclick="deleteEvaluation(${evaluation.id})" class="bg-red-500 text-white px-1 py-1 sm:px-2 rounded text-xs hover:bg-red-600">
                            ‡∏•‡∏ö
                        </button>
                    </td>
                `;
                tableBody.appendChild(row);
            });
        }

        // Delete single evaluation
        async function deleteEvaluation(id) {
            const result = await Swal.fire({
                title: '‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏•‡∏ö',
                text: '‡∏Ñ‡∏∏‡∏ì‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô‡∏ô‡∏µ‡πâ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?',
                icon: 'warning',
                showCancelButton: true,
                confirmButtonColor: '#ef4444',
                cancelButtonColor: '#6b7280',
                confirmButtonText: '‡∏•‡∏ö',
                cancelButtonText: '‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å'
            });

            if (result.isConfirmed) {
                try {
                    // Find the evaluation to get Firebase key
                    const evaluation = evaluationData.find(item => item.id === id);
                    
                    if (evaluation && evaluation.firebaseKey) {
                        // Delete from Firebase
                        await deleteFromFirebase(evaluation.firebaseKey);
                    }
                    
                    // Remove from local array
                    evaluationData = evaluationData.filter(item => item.id !== id);
                    localStorage.setItem('evaluationData', JSON.stringify(evaluationData));
                    
                    Swal.fire({
                        icon: 'success',
                        title: '‡∏•‡∏ö‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à',
                        text: '‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß',
                        confirmButtonColor: '#ec4899'
                    });
                    
                    updateAdminData();
                    updateDashboard();
                    updateEvaluationStats();
                } catch (error) {
                    console.error('Error deleting evaluation:', error);
                    Swal.fire({
                        icon: 'error',
                        title: '‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î',
                        text: '‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏î‡πâ ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á',
                        confirmButtonColor: '#ec4899'
                    });
                }
            }
        }

        // Clear all data
        async function clearAllData() {
            const result = await Swal.fire({
                title: '‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î',
                text: '‡∏Ñ‡∏∏‡∏ì‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà? ‡∏Å‡∏≤‡∏£‡∏Å‡∏£‡∏∞‡∏ó‡∏≥‡∏ô‡∏µ‡πâ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏¢‡πâ‡∏≠‡∏ô‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏î‡πâ',
                icon: 'warning',
                showCancelButton: true,
                confirmButtonColor: '#ef4444',
                cancelButtonColor: '#6b7280',
                confirmButtonText: '‡∏•‡∏ö‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î',
                cancelButtonText: '‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å'
            });

            if (result.isConfirmed) {
                try {
                    // Show loading
                    Swal.fire({
                        title: '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...',
                        text: '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏≠‡∏™‡∏±‡∏Å‡∏Ñ‡∏£‡∏π‡πà',
                        allowOutsideClick: false,
                        didOpen: () => {
                            Swal.showLoading();
                        }
                    });

                    // Clear from Firebase
                    await clearAllFirebaseData();
                    
                    // Clear local data
                    evaluationData = [];
                    localStorage.setItem('evaluationData', JSON.stringify(evaluationData));
                    
                    Swal.fire({
                        icon: 'success',
                        title: '‡∏•‡∏ö‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à',
                        text: '‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß',
                        confirmButtonColor: '#ec4899'
                    });
                    
                    updateAdminData();
                    updateDashboard();
                    updateEvaluationStats();
                } catch (error) {
                    console.error('Error clearing all data:', error);
                    Swal.fire({
                        icon: 'error',
                        title: '‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î',
                        text: '‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡πÑ‡∏î‡πâ ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á',
                        confirmButtonColor: '#ec4899'
                    });
                }
            }
        }

        // Refresh admin data
        async function refreshAdminData() {
            try {
                Swal.fire({
                    title: '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...',
                    text: '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏≠‡∏™‡∏±‡∏Å‡∏Ñ‡∏£‡∏π‡πà',
                    allowOutsideClick: false,
                    didOpen: () => {
                        Swal.showLoading();
                    }
                });

                await loadDataFromFirebase();
                
                Swal.fire({
                    icon: 'success',
                    title: '‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à',
                    text: `‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡πÅ‡∏•‡πâ‡∏ß (${evaluationData.length} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£)`,
                    timer: 1500,
                    showConfirmButton: false
                });
            } catch (error) {
                console.error('Error refreshing data:', error);
                Swal.fire({
                    icon: 'error',
                    title: '‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î',
                    text: '‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏î‡πâ',
                    confirmButtonColor: '#ec4899'
                });
            }
        }

        // Update charts
        function updateCharts(data) {
            // Clear existing charts
            const ctx1 = document.getElementById('missionChart');
            const ctx2 = document.getElementById('distributionChart');
            
            if (Chart.getChart(ctx1)) Chart.getChart(ctx1).destroy();
            if (Chart.getChart(ctx2)) Chart.getChart(ctx2).destroy();
            
            if (data.length === 0) return;

            // Mission average scores
            const missionAverages = missions.map((mission, index) => {
                const missionScores = data.flatMap(d => d.scores[index]).filter(s => s > 0);
                return missionScores.length > 0 ? missionScores.reduce((a, b) => a + b, 0) / missionScores.length : 0;
            });

            new Chart(ctx1, {
                type: 'bar',
                data: {
                    labels: missions.map((m, i) => `‡∏†‡∏≤‡∏£‡∏Å‡∏¥‡∏à ${i + 1}`),
                    datasets: [{
                        label: '‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢',
                        data: missionAverages,
                        backgroundColor: 'rgba(236, 72, 153, 0.8)',
                        borderColor: 'rgba(236, 72, 153, 1)',
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    scales: {
                        y: {
                            beginAtZero: true,
                            max: 5
                        }
                    }
                }
            });

            // Score distribution
            const allScores = data.flatMap(d => d.scores.flat()).filter(s => s > 0);
            const distribution = [1,2,3,4,5].map(score => allScores.filter(s => s === score).length);

            new Chart(ctx2, {
                type: 'doughnut',
                data: {
                    labels: ['1 ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô', '2 ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô', '3 ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô', '4 ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô', '5 ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô'],
                    datasets: [{
                        data: distribution,
                        backgroundColor: [
                            'rgba(239, 68, 68, 0.8)',
                            'rgba(245, 158, 11, 0.8)',
                            'rgba(234, 179, 8, 0.8)',
                            'rgba(236, 72, 153, 0.8)',
                            'rgba(34, 197, 94, 0.8)'
                        ]
                    }]
                },
                options: {
                    responsive: true
                }
            });
        }

        // Apply filters
        function applyFilters() {
            const filterProvince = document.getElementById('filterProvince').value;
            const filterSemester = document.getElementById('filterSemester').value;
            const filterYear = document.getElementById('filterYear').value;
            
            let filteredData = evaluationData;
            
            if (filterProvince) {
                filteredData = filteredData.filter(d => d.province === filterProvince);
            }
            
            if (filterSemester) {
                filteredData = filteredData.filter(d => d.semester === filterSemester);
            }
            
            if (filterYear) {
                filteredData = filteredData.filter(d => d.academicYear === filterYear);
            }
            
            // Update dashboard with filtered data
            document.getElementById('totalEvaluations').textContent = filteredData.length;
            document.getElementById('totalTeachers').textContent = new Set(filteredData.map(d => d.teacherName)).size;
            document.getElementById('totalSchools').textContent = new Set(filteredData.map(d => d.schoolName)).size;
            
            if (filteredData.length > 0) {
                const allScores = filteredData.flatMap(d => d.scores.flat()).filter(s => s > 0);
                const average = allScores.reduce((a, b) => a + b, 0) / allScores.length;
                document.getElementById('averageScore').textContent = average.toFixed(1);
            } else {
                document.getElementById('averageScore').textContent = '0.0';
            }
            
            updateCharts(filteredData);
            
            Swal.fire({
                icon: 'success',
                title: '‡∏Å‡∏£‡∏≠‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à',
                text: `‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• ${filteredData.length} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£`,
                timer: 1500,
                showConfirmButton: false
            });
        }

        // Export functions
        function exportToExcel() {
            if (evaluationData.length === 0) {
                Swal.fire({
                    icon: 'warning',
                    title: '‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•',
                    text: '‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏™‡πà‡∏á‡∏≠‡∏≠‡∏Å',
                    confirmButtonColor: '#ec4899'
                });
                return;
            }
            
            Swal.fire({
                icon: 'info',
                title: '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏û‡∏±‡∏í‡∏ô‡∏≤',
                text: '‡∏ü‡∏µ‡πÄ‡∏à‡∏≠‡∏£‡πå Export Excel ‡∏à‡∏∞‡∏û‡∏±‡∏í‡∏ô‡∏≤‡πÉ‡∏ô‡πÄ‡∏ß‡∏≠‡∏£‡πå‡∏ä‡∏±‡∏ô‡∏ñ‡∏±‡∏î‡πÑ‡∏õ',
                confirmButtonColor: '#ec4899'
            });
        }

        function exportToPDF() {
            if (evaluationData.length === 0) {
                Swal.fire({
                    icon: 'warning',
                    title: '‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•',
                    text: '‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏™‡πà‡∏á‡∏≠‡∏≠‡∏Å',
                    confirmButtonColor: '#ec4899'
                });
                return;
            }
            
            Swal.fire({
                icon: 'info',
                title: '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏û‡∏±‡∏í‡∏ô‡∏≤',
                text: '‡∏ü‡∏µ‡πÄ‡∏à‡∏≠‡∏£‡πå Export PDF ‡∏à‡∏∞‡∏û‡∏±‡∏í‡∏ô‡∏≤‡πÉ‡∏ô‡πÄ‡∏ß‡∏≠‡∏£‡πå‡∏ä‡∏±‡∏ô‡∏ñ‡∏±‡∏î‡πÑ‡∏õ',
                confirmButtonColor: '#ec4899'
            });
        }

        // Toggle suggestions view in admin
        function toggleSuggestionsView() {
            const view = document.getElementById('suggestionsDetailView');
            const btn = document.getElementById('toggleSuggestionsBtn');
            
            if (view.classList.contains('hidden')) {
                view.classList.remove('hidden');
                btn.textContent = 'üìù ‡∏ã‡πà‡∏≠‡∏ô‡∏Ç‡πâ‡∏≠‡πÄ‡∏™‡∏ô‡∏≠‡πÅ‡∏ô‡∏∞';
                updateDetailedSuggestions();
            } else {
                view.classList.add('hidden');
                btn.textContent = 'üìù ‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡πÄ‡∏™‡∏ô‡∏≠‡πÅ‡∏ô‡∏∞';
            }
        }

        // Update detailed suggestions
        function updateDetailedSuggestions() {
            const container = document.getElementById('suggestionsContainer');
            const data = evaluationData.filter(d => d.suggestions && 
                (d.suggestions.strengths || d.suggestions.improvements || d.suggestions.support || d.suggestions.otherSuggestions));

            if (data.length === 0) {
                container.innerHTML = '<p class="text-gray-500 italic text-center py-8">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡πÄ‡∏™‡∏ô‡∏≠‡πÅ‡∏ô‡∏∞</p>';
                return;
            }

            container.innerHTML = data.map((evaluation, index) => `
                <div class="border border-gray-200 rounded-lg p-4 bg-gray-50">
                    <div class="flex justify-between items-start mb-3">
                        <div>
                            <h4 class="font-semibold text-gray-800">${evaluation.teacherName}</h4>
                            <p class="text-sm text-gray-600">${evaluation.schoolName} - ${evaluation.province}</p>
                            <p class="text-xs text-gray-500">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô: ${evaluation.date}</p>
                        </div>
                        <span class="text-xs bg-pink-100 text-pink-800 px-2 py-1 rounded">#${index + 1}</span>
                    </div>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        ${evaluation.suggestions.strengths ? `
                            <div class="bg-green-50 rounded-lg p-3 border border-green-200">
                                <h5 class="font-medium text-green-800 mb-2 flex items-center">
                                    <span class="mr-1">‚ú®</span> ‡∏à‡∏∏‡∏î‡πÄ‡∏î‡πà‡∏ô
                                </h5>
                                <p class="text-sm text-green-700">${evaluation.suggestions.strengths}</p>
                            </div>
                        ` : ''}
                        
                        ${evaluation.suggestions.improvements ? `
                            <div class="bg-blue-50 rounded-lg p-3 border border-blue-200">
                                <h5 class="font-medium text-blue-800 mb-2 flex items-center">
                                    <span class="mr-1">üí°</span> ‡∏Ç‡πâ‡∏≠‡πÄ‡∏™‡∏ô‡∏≠‡πÅ‡∏ô‡∏∞‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏û‡∏±‡∏í‡∏ô‡∏≤
                                </h5>
                                <p class="text-sm text-blue-700">${evaluation.suggestions.improvements}</p>
                            </div>
                        ` : ''}
                        
                        ${evaluation.suggestions.support ? `
                            <div class="bg-purple-50 rounded-lg p-3 border border-purple-200">
                                <h5 class="font-medium text-purple-800 mb-2 flex items-center">
                                    <span class="mr-1">ü§ù</span> ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏™‡∏ô‡∏±‡∏ö‡∏™‡∏ô‡∏∏‡∏ô
                                </h5>
                                <p class="text-sm text-purple-700">${evaluation.suggestions.support}</p>
                            </div>
                        ` : ''}
                        
                        ${evaluation.suggestions.otherSuggestions ? `
                            <div class="bg-orange-50 rounded-lg p-3 border border-orange-200">
                                <h5 class="font-medium text-orange-800 mb-2 flex items-center">
                                    <span class="mr-1">üí¨</span> ‡∏Ç‡πâ‡∏≠‡πÄ‡∏™‡∏ô‡∏≠‡πÅ‡∏ô‡∏∞‡∏≠‡∏∑‡πà‡∏ô‡πÜ
                                </h5>
                                <p class="text-sm text-orange-700">${evaluation.suggestions.otherSuggestions}</p>
                            </div>
                        ` : ''}
                    </div>
                </div>
            `).join('');
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            initializeEvaluationTable();
            
            // Check if Firebase is ready, if not wait for it
            if (isFirebaseReady) {
                loadDataFromFirebase();
            } else {
                // Firebase will call loadDataFromFirebase when ready
                console.log('Waiting for Firebase to initialize...');
            }
        });
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'97c505c8e5fca1c3',t:'MTc1NzQwMzQ3MC4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
